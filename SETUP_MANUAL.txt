================================================================================
バツガク（BATSUGAKU）セットアップマニュアル & 作業記録
================================================================================

作成日: 2026-01-20
最終更新: 2026-01-20

このファイルには、開発者（あなた）が手動で行う必要がある作業を記録します。
Claude Codeでは自動化できない作業（外部サービスの設定など）がここに記載されます。

================================================================================
【未完了の作業一覧】
================================================================================

[ ] 1. Firebaseプロジェクト作成
[ ] 2. Firebase Authentication（Google）有効化
[ ] 3. Firestore Database作成
[ ] 4. 環境変数（.env）設定
[ ] 5. X (Twitter) Developer アカウント申請
[ ] 6. GitHub OAuth App作成
[ ] 7. Google Cloud Console OAuth設定

================================================================================
【1. Firebaseプロジェクト作成】
================================================================================

■ 手順

1. Firebase Consoleにアクセス
   URL: https://console.firebase.google.com/

2. 「プロジェクトを追加」をクリック

3. プロジェクト名を入力
   推奨名: batsugaku

4. Google Analyticsの設定
   → 今回は「このプロジェクトでGoogle Analyticsを有効にする」をオフでOK
   → 後から有効化も可能

5. 「プロジェクトを作成」をクリック

6. 作成完了まで待機（30秒〜1分程度）

================================================================================
【2. Firebaseアプリ登録 & 設定値取得】
================================================================================

■ Webアプリを登録

1. Firebase Console → 作成したプロジェクトを開く

2. プロジェクトの概要ページで「</>」（ウェブ）アイコンをクリック

3. アプリのニックネームを入力
   例: batsugaku-web

4. 「Firebase Hostingも設定する」→ チェック不要

5. 「アプリを登録」をクリック

6. 表示されるfirebaseConfigをメモ
   ※以下のような形式で表示されます

   const firebaseConfig = {
     apiKey: "AIza...",
     authDomain: "batsugaku-xxxxx.firebaseapp.com",
     projectId: "batsugaku-xxxxx",
     storageBucket: "batsugaku-xxxxx.appspot.com",
     messagingSenderId: "123456789",
     appId: "1:123456789:web:abcdef"
   };

7. これらの値を後で.envファイルに設定します

================================================================================
【3. Firebase Authentication有効化】
================================================================================

■ Google認証を有効化

1. Firebase Console → Authentication → 「始める」

2. 「Sign-in method」タブを開く

3. 「Google」をクリック

4. 「有効にする」をオン

5. プロジェクトのサポートメール: あなたのGmailアドレスを選択

6. 「保存」をクリック

■ 確認
- Googleの横に「有効」と表示されればOK

================================================================================
【4. Firestore Database作成】
================================================================================

■ データベースを作成

1. Firebase Console → Firestore Database → 「データベースを作成」

2. セキュリティルールの選択
   → 「本番モードで開始」を選択
   ※後でセキュリティルールを設定します

3. ロケーションの選択
   推奨: asia-northeast1（東京）

4. 「有効にする」をクリック

5. 作成完了まで待機（1分程度）

■ セキュリティルール設定（後で実施）

Firestore → ルール で以下を設定:

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ユーザーは自分のドキュメントのみ読み書き可能
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 日次ログは認証済みユーザーが自分のもののみアクセス可能
    match /dailyLogs/{logId} {
      allow read, write: if request.auth != null &&
        resource.data.userId == request.auth.uid;
      allow create: if request.auth != null &&
        request.resource.data.userId == request.auth.uid;
    }

    // バッジマスターは全員読み取り可能
    match /badges/{badgeId} {
      allow read: if true;
      allow write: if false;
    }

    // アプリ統計は読み取りのみ
    match /appStats/{docId} {
      allow read: if true;
      allow write: if false;
    }
  }
}

================================================================================
【5. 環境変数（.env）設定】
================================================================================

■ ファイル作成

ターミナルで以下を実行:
cd /Users/jime0083/Batugaku2
cp .env.example .env

■ .envファイルを編集

以下の値をFirebaseから取得した値に置き換えてください:

# Firebase設定（手順2で取得した値）
EXPO_PUBLIC_FIREBASE_API_KEY=【apiKeyの値】
EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN=【authDomainの値】
EXPO_PUBLIC_FIREBASE_PROJECT_ID=【projectIdの値】
EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET=【storageBucketの値】
EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=【messagingSenderIdの値】
EXPO_PUBLIC_FIREBASE_APP_ID=【appIdの値】

# 以下は後で設定（X API, GitHub）
EXPO_PUBLIC_X_CLIENT_ID=後で設定
X_CLIENT_SECRET=後で設定
EXPO_PUBLIC_GITHUB_CLIENT_ID=後で設定
GITHUB_CLIENT_SECRET=後で設定

================================================================================
【6. X (Twitter) Developer アカウント申請】
================================================================================

※この作業はPhase Bで必要になります。今すぐでなくてもOKです。
※審査に時間がかかるため、早めに申請することを推奨します。

■ 確認手順（既存アカウントがあるか確認）

1. X Developer Portalにアクセス
   URL: https://developer.x.com/

2. Xアカウントでログイン

3. 「Dashboard」が表示されれば → 作成済み
   「Apply for access」等が表示されれば → 未作成

■ 新規申請手順（未作成の場合）

1. https://developer.x.com/en/portal/petition/essential/basic-info

2. 利用目的を入力
   例: "Building a personal learning accountability app that posts
        automated tweets based on GitHub activity to encourage
        consistent coding practice."

3. 審査完了を待つ（数分〜数日）

■ アプリ作成手順（Developerアカウント取得後）

1. Developer Portal → Projects & Apps → 「+ Create App」

2. アプリ名: batsugaku

3. App permissions: Read and Write

4. Type of App: Web App

5. OAuth 2.0設定:
   - Callback URL: batsugaku://oauth/twitter
   - Website URL: https://example.com（仮）

6. Client ID と Client Secret をメモ
   → .envファイルに設定

================================================================================
【7. GitHub OAuth App作成】
================================================================================

※この作業はPhase Bで必要になります。

■ 作成手順

1. GitHub Developer Settingsにアクセス
   URL: https://github.com/settings/developers

2. 「OAuth Apps」→「New OAuth App」

3. 以下を入力:
   - Application name: バツガク
   - Homepage URL: https://example.com（仮）
   - Authorization callback URL: batsugaku://oauth/github

4. 「Register application」をクリック

5. Client ID をメモ

6. 「Generate a new client secret」をクリック

7. Client Secret をメモ（一度しか表示されません！）

8. .envファイルに設定:
   EXPO_PUBLIC_GITHUB_CLIENT_ID=【Client ID】
   GITHUB_CLIENT_SECRET=【Client Secret】

================================================================================
【8. Google Cloud Console OAuth設定】
================================================================================

※Firebase AuthenticationでGoogleログインを使う場合に必要

■ 確認手順

1. Google Cloud Consoleにアクセス
   URL: https://console.cloud.google.com/

2. Firebaseと同じプロジェクトを選択

3. 「APIとサービス」→「認証情報」

4. 「OAuth 2.0 クライアント ID」に以下があることを確認:
   - Web client（Firebaseが自動作成）
   - iOS client（必要に応じて作成）
   - Android client（必要に応じて作成）

■ iOS用OAuth設定（iPhone実機テスト用）

1. 「認証情報を作成」→「OAuth クライアント ID」

2. アプリケーションの種類: iOS

3. 名前: batsugaku-ios

4. バンドルID: com.batsugaku.app

5. 「作成」→ Client ID をメモ

6. .envに追加:
   EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID=【iOS Client ID】

================================================================================
【動作確認コマンド】
================================================================================

■ ブラウザで確認
npm run web

■ iOS Simulatorで確認
npm run ios

■ iPhone実機で確認（Development Build）
npx expo run:ios

================================================================================
【作業完了チェックリスト】
================================================================================

Firebase基本設定:
[ ] プロジェクト作成完了
[ ] Webアプリ登録完了
[ ] firebaseConfig値をメモ
[ ] Authentication有効化完了
[ ] Firestore作成完了

環境変数設定:
[ ] .envファイル作成完了
[ ] Firebase設定値を入力完了
[ ] 動作確認完了

X API（Phase B）:
[ ] Developer申請完了
[ ] アプリ作成完了
[ ] OAuth設定完了
[ ] .envに設定完了

GitHub OAuth（Phase B）:
[ ] OAuth App作成完了
[ ] .envに設定完了

================================================================================
【トラブルシューティング】
================================================================================

■ 「Firebase: Error (auth/configuration-not-found)」
→ .envのFirebase設定値が正しくない可能性があります
→ Firebase Consoleで値を再確認してください

■ 「Network request failed」
→ インターネット接続を確認
→ Firebase Consoleでプロジェクトが有効か確認

■ 「Google sign in error」
→ Firebase AuthenticationでGoogleが有効になっているか確認
→ OAuth同意画面が設定されているか確認

================================================================================
【更新履歴】
================================================================================

2026-01-20: 初版作成
  - Firebaseセットアップ手順を追加
  - X API申請手順を追加
  - GitHub OAuth手順を追加
  - 環境変数設定手順を追加

================================================================================
