================================================================================
BATSUGAKU (バツガク) - 要件定義書
================================================================================

作成日: 2026-01-20
最終更新: 2026-01-20
設定: Everything Claude Code (cogsec) 使用

================================================================================
1. プロジェクト概要
================================================================================

【アプリ名】
バツガク（罰学）

【コンセプト】
「サボれない学習サポートアプリ」
- 毎日GitHubにpushしないと、Xに自動でサボり投稿が投稿される
- フォロワーの監視による心理的プレッシャーで学習継続を促進
- ストリーク（連続学習日数）とバッジでモチベーション維持

【ターゲットユーザー】
- プログラミング学習中のエンジニア志望者
- 収入目標を持つ駆け出しエンジニア
- 学習習慣を身につけたい人

================================================================================
2. 技術スタック
================================================================================

【フレームワーク】
- React Native (Expo SDK 54)
- Expo Router v6 (ファイルベースルーティング)

【バックエンド】
- Firebase Authentication (認証)
- Cloud Firestore (データベース)
- Firebase Cloud Messaging (プッシュ通知)

【認証】
- Google OAuth 2.0 (メイン認証)
- GitHub OAuth (push検出用)
- X (Twitter) OAuth 2.0 PKCE (自動投稿用)

【外部API】
- GitHub Events API (pushイベント検出)
- X API v2 (ツイート投稿)

【テスト】
- Jest
- React Native Testing Library

================================================================================
3. 機能要件
================================================================================

--------------------------------------------------------------------------------
3.1 認証機能
--------------------------------------------------------------------------------

【Google認証】 ※実装済み
- Googleアカウントでのログイン/ログアウト
- 新規ユーザーのFirestore自動登録
- 認証状態の永続化

【GitHub連携】 ※未実装
- GitHub OAuth認証フロー
- アクセストークンの安全な保存
- GitHubユーザー名の取得・表示
- トークンを使用したAPI呼び出し

【X (Twitter) 連携】 ※未実装
- X OAuth 2.0 PKCE認証フロー
- アクセストークン・リフレッシュトークンの保存
- トークン自動リフレッシュ
- ユーザー代理でのツイート投稿権限

--------------------------------------------------------------------------------
3.2 オンボーディング機能 ※実装済み
--------------------------------------------------------------------------------

【Step 1: 目標収入設定】
- 月収/年収の選択
- 目標金額の入力（万円単位）

【Step 2: 学習スキル選択】
- 複数スキルの選択可能
- 選択肢: JavaScript, TypeScript, React, Python, Go, etc.

【Step 3: 目標期限設定】
- 日数での入力（例: 90日後）
- 目標日の自動計算・表示

【Step 4: 確認・完了】
- 設定内容の確認
- 注意事項の表示（サボり投稿について）
- Firestoreへの保存

--------------------------------------------------------------------------------
3.3 ダッシュボード機能 ※実装済み（一部ダミーデータ）
--------------------------------------------------------------------------------

【ユーザー情報表示】
- 名前、目標の表示

【連続学習日数】
- 現在のストリーク表示
- 最長記録の表示

【週間カレンダー】
- 今週の学習状況をビジュアル表示
- 学習済み/未学習の区別

【統計カード】
- 今月の学習日数
- 今月のサボり日数
- 累計学習日数
- 累計サボり日数

【連携状態】
- GitHub連携状態
- X連携状態

--------------------------------------------------------------------------------
3.4 日次チェック機能 ※未実装
--------------------------------------------------------------------------------

【GitHub push検出】
- GitHub Events APIを使用
- 当日0:00〜23:59のpushイベントを検出
- 対象: ユーザーの全publicリポジトリ

【判定ロジック】
- 0:00までにpushがあれば「学習済み」
- pushがなければ「サボり」と判定
- 判定時刻: 毎日0:00 (JST)

【自動ツイート投稿】
- サボり判定時: サボりツイート自動投稿
- ストリーク達成時: 達成ツイート自動投稿
- マイルストーン: 5, 10, 15, 20, 25, 30, 50, 100, 200, 365日

【DailyLog記録】
- 日付、pushの有無、ツイート済みフラグをFirestoreに保存

--------------------------------------------------------------------------------
3.5 バッジ機能 ※実装済み（授与ロジック未実装）
--------------------------------------------------------------------------------

【連続学習バッジ】
- 5日連続, 10日連続, 15日連続, 30日連続, 100日連続, 365日連続

【累計学習バッジ】
- 累計10日, 30日, 100日, 365日

【累計サボりバッジ】
- 初サボり, サボり10回, サボり30回

【表示】
- 獲得済み/未獲得の区別
- カテゴリ別表示

--------------------------------------------------------------------------------
3.6 設定機能 ※実装済み（連携機能未実装）
--------------------------------------------------------------------------------

【プロフィール表示】
- 名前、メールアドレス

【目標設定】
- 目標の表示・編集

【アカウント連携】
- GitHub連携/解除
- X連携/解除

【通知設定】
- プッシュ通知ON/OFF

【アカウント】
- ログアウト

--------------------------------------------------------------------------------
3.7 通知機能 ※未実装
--------------------------------------------------------------------------------

【リマインダー通知】
- 23:00: 学習リマインダー
- 23:30: 最終警告

【達成通知】
- push検出時: お疲れ様通知
- ストリーク達成時: 祝福通知

================================================================================
4. 非機能要件
================================================================================

【セキュリティ】
- OAuthトークンの安全な保存（Firestore Security Rules）
- 環境変数によるAPIキー管理
- ユーザー入力のバリデーション

【パフォーマンス】
- GitHub API Rate Limit考慮（5000リクエスト/時間）
- X API Free Tier制限考慮（1500ツイート/月）

【可用性】
- オフライン時のエラーハンドリング
- ネットワークエラー時のリトライ

【テスト】
- 80%以上のコードカバレッジ（cogsec要件）
- TDD（テスト駆動開発）推奨

================================================================================
5. データモデル
================================================================================

【User】
- uid: string (Firebase Auth UID)
- email: string
- displayName: string
- photoURL: string | null
- createdAt: Timestamp
- googleLinked: boolean
- xLinked: boolean
- xUserId: string | null
- xAccessToken: string | null
- xRefreshToken: string | null
- xTokenExpiresAt: Timestamp | null
- githubLinked: boolean
- githubUsername: string | null
- githubAccessToken: string | null
- goal: UserGoal | null
- stats: UserStats
- badges: string[]
- fcmToken: string | null
- notificationsEnabled: boolean
- onboardingCompleted: boolean

【UserGoal】
- deadline: Timestamp
- skills: string[]
- targetIncome: number
- incomeType: 'monthly' | 'yearly'

【UserStats】
- currentMonthStudyDays: number
- currentMonthSkipDays: number
- totalStudyDays: number
- totalSkipDays: number
- currentStreak: number
- longestStreak: number
- lastStudyDate: Timestamp | null
- lastCheckedDate: Timestamp | null

【DailyLog】
- id: string
- userId: string
- date: string (YYYY-MM-DD)
- hasPushed: boolean
- pushCount: number
- pushedAt: Timestamp | null
- skipped: boolean
- tweetedSkip: boolean
- tweetedStreak: boolean
- streakMilestone: number | null
- createdAt: Timestamp

================================================================================
6. 実装優先順位
================================================================================

【Phase 1: 基盤実装】 ※完了
1. プロジェクトセットアップ
2. Firebase設定
3. Google認証
4. 基本UI（ログイン、オンボーディング、ダッシュボード、設定、バッジ）

【Phase 2: OAuth連携】 ← 現在のフェーズ
1. GitHub OAuth連携
2. X (Twitter) OAuth 2.0 PKCE連携

【Phase 3: コア機能】
1. GitHub push検出
2. 日次チェックロジック
3. 自動ツイート投稿
4. DailyLog管理

【Phase 4: 補助機能】
1. バッジ授与ロジック
2. プッシュ通知
3. 統計の実データ連携

【Phase 5: 品質向上】
1. テストカバレッジ80%達成
2. エラーハンドリング強化
3. パフォーマンス最適化

================================================================================
7. 環境変数
================================================================================

# Firebase
EXPO_PUBLIC_FIREBASE_API_KEY=
EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN=
EXPO_PUBLIC_FIREBASE_PROJECT_ID=
EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET=
EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=
EXPO_PUBLIC_FIREBASE_APP_ID=

# Google OAuth
EXPO_PUBLIC_GOOGLE_CLIENT_ID=
EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID=
EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID=
EXPO_PUBLIC_GOOGLE_WEB_CLIENT_ID=

# GitHub OAuth
EXPO_PUBLIC_GITHUB_CLIENT_ID=
EXPO_PUBLIC_GITHUB_CLIENT_SECRET=

# X (Twitter) OAuth
EXPO_PUBLIC_X_CLIENT_ID=
EXPO_PUBLIC_X_CLIENT_SECRET=

================================================================================
8. 参考リンク
================================================================================

- GitHub OAuth Documentation: https://docs.github.com/en/developers/apps/building-oauth-apps
- X API v2 Documentation: https://developer.twitter.com/en/docs/twitter-api
- Expo AuthSession: https://docs.expo.dev/versions/latest/sdk/auth-session/
- Firebase Documentation: https://firebase.google.com/docs

================================================================================
